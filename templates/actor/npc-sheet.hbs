<form class="hwfwm sheet actor npc" autocomplete="off">
  <!-- HEADER -->
  <header class="sheet-header flexrow">
    <div class="profile">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
    </div>

    <div class="header-fields">
      <div class="name-row">
        <input name="name" type="text" value="{{actor.name}}" placeholder="Name" />
      </div>

      <div class="meta-row flexrow">
        <div class="field">
          <label>Role / Rank</label>
          <input type="text" name="system.details.rank" value="{{system.details.rank}}" />
        </div>
        <div class="field">
          <label>Level</label>
          <input type="number" name="system.details.level" value="{{system.details.level}}" />
        </div>
        <div class="field">
          <label>Species</label>
          <input type="text" name="system.details.species" value="{{system.details.species}}" />
        </div>
      </div>

      <div class="tags-row">
        <label>Tags</label>
        <input type="text" name="system.traits.tagsString" value="{{system.traits.tagsString}}" placeholder="Comma-separated tags" />
      </div>
    </div>
  </header>

  <!-- BODY -->
  <section class="sheet-body">
    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="overview">Overview</a>
      <a class="item" data-tab="actions">Actions</a>
      <a class="item" data-tab="notes">Notes</a>
    </nav>

    <section class="sheet-content">

      <!-- TAB: OVERVIEW -->
      <div class="tab overview" data-group="primary" data-tab="overview">
        <div class="flexrow">

          <!-- Quick Stats -->
          <section class="card npc-core">
            <h2>Core Stats</h2>
            <div class="npc-core-grid">
              <div class="core-field">
                <label>Life Force</label>
                <input type="number" name="system.resources.lifeforce.value" value="{{system.resources.lifeforce.value}}" />
                <span>/</span>
                <input type="number" name="system.resources.lifeforce.max" value="{{system.resources.lifeforce.max}}" />
              </div>

              <div class="core-field">
                <label>Trauma</label>
                <input type="number" name="system.resources.trauma.value" value="{{system.resources.trauma.value}}" />
                <span>/</span>
                <input type="number" name="system.resources.trauma.max" value="{{system.resources.trauma.max}}" />
              </div>

              <div class="core-field">
                <label>Armor (AP)</label>
                <input type="number" name="system.resources.armor.value" value="{{system.resources.armor.value}}" />
                <span>/</span>
                <input type="number" name="system.resources.armor.max" value="{{system.resources.armor.max}}" />
              </div>

              <div class="core-field">
                <label>Shielding</label>
                <input type="number" name="system.resources.shielding.value" value="{{system.resources.shielding.value}}" />
              </div>

              <div class="core-field">
                <label>Defense</label>
                <input type="number" name="system.defenses.defense.value" value="{{system.defenses.defense.value}}" />
              </div>

              <div class="core-field">
                <label>Reaction</label>
                <input type="number" name="system.defenses.reaction.value" value="{{system.defenses.reaction.value}}" />
              </div>
            </div>
          </section>

          <!-- Compact Attributes -->
          <section class="card npc-attributes">
            <h2>Attributes</h2>
            <div class="npc-attr-grid">
              {{#each system.attributes as |attr key|}}
              <div class="npc-attr">
                <span class="label">{{attr.label}}</span>
                <input type="number" name="system.attributes.{{key}}.base" value="{{attr.base}}" />
              </div>
              {{/each}}
            </div>
          </section>

        </div>
      </div>

      <!-- TAB: ACTIONS -->
      <div class="tab actions" data-group="primary" data-tab="actions">
        <div class="flexrow">

          <!-- Offensive / Active Abilities -->
          <section class="card">
            <h2>Offensive & Active</h2>
            <table class="npc-actions-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Res</th>
                  <th>Cost</th>
                  <th>Dmg</th>
                  <th>Dmg Type</th>
                  <th>Range</th>
                </tr>
              </thead>
              <tbody>
                {{#each itemTypes.weapon as |w|}}
                <tr class="item weapon" data-item-id="{{w._id}}">
                  <td><a class="item-edit">{{w.name}}</a></td>
                  <td>Weapon</td>
                  <td>-</td>
                  <td>-</td>
                  <td>{{w.system.damage}}</td>
                  <td></td>
                  <td>{{w.system.range}}</td>
                </tr>
                {{/each}}

                {{#each itemTypes.essenceAbility as |ea|}}
                <tr class="item essence-ability" data-item-id="{{ea._id}}">
                  <td><a class="item-edit">{{ea.name}}</a></td>
                  <td>Essence</td>
                  <td>{{ea.system.resource}}</td>
                  <td>{{ea.system.cost}}</td>
                  <td>{{ea.system.damage}}</td>
                  <td>{{ea.system.damageType}}</td>
                  <td>{{ea.system.range}}</td>
                </tr>
                {{/each}}

                {{#each itemTypes.racialAbility as |ra|}}
                <tr class="item racial-ability" data-item-id="{{ra._id}}">
                  <td><a class="item-edit">{{ra.name}}</a></td>
                  <td>Racial</td>
                  <td>{{ra.system.resource}}</td>
                  <td>{{ra.system.cost}}</td>
                  <td>{{ra.system.damage}}</td>
                  <td>{{ra.system.damageType}}</td>
                  <td>{{ra.system.range}}</td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </section>

          <!-- Defenses / Passives -->
          <section class="card">
            <h2>Defenses & Traits</h2>
            <ul class="item-list">
              {{#each itemTypes.armor as |a|}}
              <li class="item armor" data-item-id="{{a._id}}">
                <a class="item-edit">{{a.name}}</a>
                (Def {{a.system.defense}}, AP {{a.system.armorPoints}})
                {{#if a.system.armorDepleted}}<span class="depleted">[Depleted]</span>{{/if}}
              </li>
              {{/each}}

              {{#each itemTypes.feature as |f|}}
              <li class="item feature" data-item-id="{{f._id}}">
                <a class="item-edit">{{f.name}}</a> â€” {{f.system.type}}
              </li>
              {{/each}}

              {{#each itemTypes.essence as |e|}}
              <li class="item essence" data-item-id="{{e._id}}">
                <a class="item-edit">{{e.name}}</a> ({{e.system.category}} {{e.system.rarity}})
              </li>
              {{/each}}

              {{#each itemTypes.magicStone as |s|}}
              <li class="item magic-stone" data-item-id="{{s._id}}">
                <a class="item-edit">{{s.name}}</a> ({{s.system.rarity}})
              </li>
              {{/each}}
            </ul>
          </section>

        </div>
      </div>

      <!-- TAB: NOTES -->
      <div class="tab notes" data-group="primary" data-tab="notes">
        <section class="card">
          <h2>Description</h2>
          {{editor system.notes.biography target="system.notes.biography" button=true owner=owner editable=editable}}
        </section>
        <section class="card">
          <h2>GM Notes</h2>
          {{editor system.notes.gmNotes target="system.notes.gmNotes" button=true owner=owner editable=editable}}
        </section>
      </div>

    </section>
  </section>
</form>
